(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{9215:function(e,t,n){Promise.resolve().then(n.bind(n,4457))},4457:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return er}});var s,l,i,o,c=n(7437),r=n(504);function a(e){let{icon:t,hint:n,onClick:s}=e;return(0,c.jsx)("button",{className:"icon",onClick:s,title:n,children:(0,c.jsx)(r.G,{icon:t})})}var u=n(2759);class d{async load(e){let t=await new Promise(t=>{let n=new FileReader;n.addEventListener("load",e=>{var n;t(null===(n=e.target)||void 0===n?void 0:n.result)}),n.readAsText(e)});if(!t)throw Error("Cannot read file ".concat(e.name));return t}async save(e,t){let n=document.createElement("a"),s=URL.createObjectURL(new Blob([e],{type:this.mimeType}));n.href=s,n.download=t,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(s)}constructor(e,t){this.extension=e,this.mimeType=t}}let h=[new d("csv","text/csv")];(s=i||(i={})).Text="text",s.Table="table";class f{contains(e,t){for(let n=0;n<this.excluded.length;n+=2)if(this.excluded[n]===e&&this.excluded[n+1]===t)return!1;return this.inRange(e,t)}expand(e,t){this.endRow=e,this.endCell=t}exclude(e,t,n,s){if("number"==typeof e&&"number"==typeof t&&void 0===n&&void 0===s)this.contains(e,t)&&this.excluded.push(e,t);else{let l="object"==typeof e,i=l?e.minRow:e,o=l?e.maxRow:null!=n?n:e,c=l?e.minCell:t,r=l?e.maxCell:null!=s?s:t;for(let e=i;e<=o;e++)for(let t=c;t<=r;t++)this.exclude(e,t)}}insert(e,t,n,s){let l=this.minRow,i=this.maxRow,o=this.minCell,c=this.maxCell,r=!1;if(0!==n){n<0&&l>=e&&l<e-n?l=e:l>=e&&(l+=n),i>=e&&(i+=n);for(let t=0;t<this.excluded.length;t+=2){let s=this.excluded[t];n<0&&s>=e&&s<e-n?s=-1:s>=e&&(s+=n),this.excluded[t]=s}l>i&&(i=l,r=!0)}if(0!==s){s<0&&o>=t&&o<t-s?o=t:o>=t&&(o+=s),c>=t&&(c+=s);for(let e=1;e<this.excluded.length;e+=2){let n=this.excluded[e];s<0&&n>=t&&n<t-s?n=-1:n>=t&&(n+=s),this.excluded[e]=n}o>c&&(c=o,r=!0)}let a=this.startRow<=this.endRow;this.startRow=a?l:i,this.endRow=a?i:l;let u=this.startCell<=this.endCell;this.startCell=u?o:c,this.endCell=u?c:o;let d=[...this.excluded];this.excluded=[];for(let e=0;e<d.length;e+=2)this.exclude(d[e],d[e+1]);r&&this.exclude(l,o,i,c)}isEmpty(){return this.excluded.length>=(1+Math.abs(this.startRow-this.endRow))*(1+Math.abs(this.startCell-this.endCell))*2}isStart(e,t){return this.startRow===e&&this.startCell===t}inRange(e,t){return(this.startRow<=this.endRow?e>=this.startRow&&e<=this.endRow:e<=this.startRow&&e>=this.endRow)&&(this.startCell<=this.endCell?t>=this.startCell&&t<=this.endCell:t<=this.startCell&&t>=this.endCell)}get minRow(){return Math.min(this.startRow,this.endRow)}get maxRow(){return Math.max(this.startRow,this.endRow)}get minCell(){return Math.min(this.startCell,this.endCell)}get maxCell(){return Math.max(this.startCell,this.endCell)}constructor(e,t,n,s){this.startRow=e,this.startCell=t,this.endRow=n,this.endCell=s,this.excluded=[]}}class m{contains(e,t){var n,s;return!(null===(n=this.draftExcluded)||void 0===n?void 0:n.contains(e,t))&&((null===(s=this.draftIncluded)||void 0===s?void 0:s.contains(e,t))||this.ranges.some(n=>n.contains(e,t)))}isFocus(e,t){return this.focus[0]===e&&this.focus[1]===t}setFocus(e,t){this.focus[0]=e,this.focus[1]=t}hasFocus(){return this.focus[0]>=0&&this.focus[1]>=0}get focusRow(){return this.focus[0]}get focusCell(){return this.focus[1]}clearFocus(){this.focus[0]=-1,this.focus[1]=-1}clearSelection(){this.ranges=[],this.draftIncluded=void 0,this.draftExcluded=void 0,this.draftInserted=void 0}isEmpty(){return this.ranges.every(e=>e.isEmpty())}selectRange(e,t,n,s,l){if(l)this.draftIncluded=new f(e,t,n,s);else{let l=new f(e,t,n,s);this.ranges.push(l),this.combineRanges(l)}}expandRange(e,t,n,s,l){var i;let o=null!==(i=this.ranges.pop())&&void 0!==i?i:new f(e,t,n,s);o.expand(n,s),l&&this.clearSelection(),this.ranges.push(o),this.combineRanges(o)}removeRange(e,t){this.ranges=this.ranges.filter(n=>!n.isStart(e,t))}excludeRange(e,t,n,s,l){if(l)this.draftExcluded=new f(e,t,n,s);else{let l=new f(e,t,n,s);this.ranges.forEach(e=>e.exclude(l)),this.clearRanges()}}commitDraft(){if(this.draftIncluded&&(this.ranges.push(this.draftIncluded),this.combineRanges(this.draftIncluded),this.draftIncluded=void 0),this.draftExcluded&&(this.ranges.forEach(e=>e.exclude(this.draftExcluded)),this.clearRanges(),this.draftExcluded=void 0),this.draftInserted){let[e,t,n,s]=this.draftInserted,[l,i]=this.focus;e>=0&&(n<0&&l>=e&&l<e-n?l=-1:l>=e&&(l+=n)),t>=0&&(s<0&&i>=t&&i<t-s?i=-1:i>=t&&(i+=s)),this.focus[0]=l,this.focus[1]=i,this.ranges.forEach(l=>l.insert(e,t,n,s)),this.clearRanges(),this.draftInserted=void 0}}insertRow(e,t){this.draftInserted=[e,-1,null!=t?t:1,0]}insertColumn(e,t){this.draftInserted=[-1,e,0,null!=t?t:1]}combineRanges(e){this.ranges.forEach(t=>{t!==e&&t.exclude(e)}),this.clearRanges()}clearRanges(){this.ranges=this.ranges.filter(e=>!e.isEmpty())}getBounds(){let e=[-1,-1,-1,-1];for(let t of this.ranges)(-1===e[0]||e[0]>t.minRow)&&(e[0]=t.minRow),(-1===e[1]||e[1]>t.minCell)&&(e[1]=t.minCell),(-1===e[2]||e[2]<t.maxRow)&&(e[2]=t.maxRow),(-1===e[3]||e[3]<t.maxCell)&&(e[3]=t.maxCell);return e}*[Symbol.iterator](){let[e,t,n,s]=this.getBounds(),l=!1;if(e>=0&&t>=0){let i=[-1,-1];for(let o=e;o<=n;o++)for(let e=t;e<=s;e++)this.contains(o,e)&&(i[0]=o,i[1]=e,l=!0,yield i)}!l&&this.hasFocus()&&(yield[this.focusRow,this.focusCell])}copyCells(e){var t,n,s,l,i,o;let c=[],r=-1,a=-1,u=-1;for(let[n,s]of this)r<0&&(r=n),a<0&&(a=s),s>u&&(u=s),(null===(t=e[n])||void 0===t?void 0:t[s])!==void 0&&(void 0===c[n-r]&&(c[n-r]=[]),c[n-r][s-a]=e[n][s]);for(let e=0;e<c.length;e++){null!==(s=c[n=e])&&void 0!==s||(c[n]=[]);for(let t=0;t<=u-a;t++)null!==(o=(l=c[e])[i=t])&&void 0!==o||(l[i]="")}return c}pasteCells(e,t,n,s){var l,i,o,c,r,a,u;let d=-1;for(let o=0;o<t.length;o++){null!==(i=e[l=o+n])&&void 0!==i||(e[l]=[]);for(let l=0;l<t[o].length;l++)""!==t[o][l]&&void 0!==t[o][l]&&(e[o+n][l+s]=t[o][l],d<l&&(d=l))}for(let t=0;t<e.length;t++){null!==(c=e[o=t])&&void 0!==c||(e[o]=[]);for(let n=0;n<=s+d;n++)null!==(u=(r=e[t])[a=n])&&void 0!==u||(r[a]="")}}clearCells(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";for(let[s,l]of this){var n;(null===(n=e[s])||void 0===n?void 0:n[l])!==void 0&&(e[s][l]=t)}}clear(){this.clearSelection(),this.clearFocus()}constructor(){this.ranges=[],this.focus=[-1,-1]}}function v(e,t){let n=e.file.tableSelection;switch(t.action){case"update":return{...e,file:t.file};case"setFocus":n.setFocus(t.rowIndex,t.cellIndex);break;case"clearFocus":n.clearFocus();break;case"clearSelection":n.clearSelection();break;case"selectRange":t.clear&&n.clearSelection(),t.replace&&n.removeRange(t.range[0],t.range[1]),t.range.length>2?n.selectRange(...t.range,t.draft):n.selectRange(...t.range,...t.range,t.draft);break;case"expandRange":t.range.length>2?n.expandRange(...t.range,t.clear):n.expandRange(...t.range,...t.range,t.clear);break;case"excludeRange":t.range.length>2?n.excludeRange(...t.range,t.draft):n.excludeRange(...t.range,...t.range,t.draft);break;case"commitDraft":n.commitDraft();break;case"insertRow":n.insertRow(t.rowIndex,t.rows);break;case"insertColumn":n.insertColumn(t.columnIndex,t.columns)}return{...e}}let x=0;class w{async load(){this.file&&(this.textContent=await this.loader.load(this.file))}async save(){await this.loader.save(this.textContent,this.filename)}constructor(e){var t;if(this.file=e,this.id=++x,this.textContent="",this.selected=!1,this.editMode=i.Table,this.tableSelection=new m,this.filename=null!==(t=null==e?void 0:e.name)&&void 0!==t?t:"untitled.csv",this.extension=this.filename.replace(/^.*\.(\w+)$/,"$1").toLowerCase(),this.loader=h.filter(e=>e.extension===this.extension)[0],!this.loader)throw Error("Unknown file extension ".concat(this.filename))}}function g(e){let{onOpen:t}=e;return(0,c.jsx)(a,{icon:u.cC_,onClick:function(){let e=document.createElement("input");e.type="file",e.multiple=!0,e.accept=h.map(e=>".".concat(e.extension,",").concat(e.mimeType)).join(","),e.onchange=async()=>{if(e.files)for(let n=0;n<e.files.length;n++){let s=new w(e.files.item(n));await s.load(),null==t||t(s)}},e.click()},hint:"Open File"})}var p=n(7188);function R(e){var t;let{item:n,onSelect:s,onRemove:l}=e,i="tab ".concat(n.selected?"selected":""," ").concat(n.editable?"editable":"");return(0,c.jsxs)("li",{className:i,children:[(0,c.jsxs)("button",{className:"label",title:null!==(t=n.hint)&&void 0!==t?t:n.name,onClick:()=>{n.selected||null==s||s()},children:[n.icon&&(0,c.jsx)("span",{className:"icon",children:(0,c.jsx)(r.G,{icon:n.icon})}),n.name&&(0,c.jsx)("span",{className:"name",children:n.name})]}),n.removable&&(0,c.jsx)(a,{icon:u.g82,hint:"Close",onClick:l})]})}function y(e){let{items:t,onRename:n,onSelect:s,onRemove:l}=e;return(0,c.jsx)("ul",{className:"tabs",children:t.map(e=>(0,c.jsx)(R,{item:e,onSelect:()=>null==s?void 0:s(e),onRemove:()=>null==l?void 0:l(e)},e.key))})}class b{get key(){return"".concat(this.file.id)}get selected(){return this.file.selected}get link(){return"/".concat(this.name)}constructor(e){this.file=e,this.name=this.file.filename,this.removable=!0,this.editable=!0}}class C{get selected(){return this.file.editMode===this.editMode}constructor(e,t,n,s){this.file=e,this.editMode=t,this.icon=n,this.hint=s,this.key=this.editMode,this.editable=!1,this.removable=!1}}function S(e){let{file:t}=e;async function n(){await t.save()}return(0,c.jsx)(a,{icon:u.kwI,onClick:n,hint:"Save File"})}function I(e){let{onOpen:t}=e;async function n(){let e=new w;await e.load(),null==t||t(e)}return(0,c.jsx)(a,{icon:u.gMD,onClick:n,hint:"New File"})}function E(e){let{filesReducer:[t,n]}=e,s=t.files,l=t.selectedFile;function o(e){n({file:e,type:"add"})}return(0,c.jsxs)("nav",{children:[(0,c.jsx)(g,{onOpen:o}),(0,c.jsx)(I,{onOpen:o}),l&&(0,c.jsx)(S,{file:l}),(0,c.jsx)(y,{items:s.map(e=>new b(e)),onSelect:e=>n({file:e.file,type:"select"}),onRemove:e=>n({file:e.file,type:"remove"})}),l&&(0,c.jsx)(y,{items:[new C(l,i.Text,p.nfZ,"Text"),new C(l,i.Table,u.DaQ,"Table")],onSelect:e=>{l.editMode=e.editMode,n({file:t.selectedFile,type:"update"})}})]})}var D=n(2265);function F(e,t){let n=e.files;switch(t.type){case"add":n.forEach(e=>e.selected=!1);let s=n.filter(e=>e.id===t.file.id)[0];s?s.selected=!0:(t.file.selected=!0,n.push(t.file));break;case"select":n.forEach(e=>e.selected=!1),t.file.selected=!0;break;case"remove":let l=n.indexOf(t.file);l>=0&&(n.splice(l,1),t.file.selected&&(l<n.length?n[l].selected=!0:l-1>=0&&(n[l-1].selected=!0)))}return{files:n,selectedFile:n.filter(e=>e.selected)[0]}}function j(e){let{file:t}=e,[n,s]=(0,D.useState)(t.textContent);return n!==t.textContent&&s(t.textContent),(0,c.jsx)("textarea",{className:"text-editor",value:n,onChange:e=>{t.textContent=e.target.value,t.tableSelection.clear(),s(e.target.value)},onScroll:e=>{}})}function k(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.map(e=>"string"==typeof e?e:"object"==typeof e?Object.keys(e).filter(t=>e[t]).join(" "):"").join(" ")}(l=o||(o={})).F1="F1",l.F2="F2",l.F3="F3",l.F4="F4",l.F5="F5",l.F6="F6",l.F7="F7",l.F8="F8",l.F9="F9",l.F10="F10",l.F11="F11",l.F12="F12",l.Escape="Escape",l.Enter="Enter",l.Tab="Tab",l.Delete="Delete",l.Home="Home",l.End="End",l.ArrowUp="ArrowUp",l.ArrowDown="ArrowDown",l.ArrowLeft="ArrowLeft",l.ArrowRight="ArrowRight",l.A="A",l.B="B",l.C="C",l.D="D",l.E="E",l.F="F",l.G="G",l.H="H",l.I="I",l.J="J",l.K="K",l.L="L",l.M="M",l.N="N",l.O="O",l.P="P",l.Q="Q",l.R="R",l.S="S",l.T="T",l.U="U",l.V="V",l.W="W",l.X="X",l.Y="Y",l.Z="Z",l.a="a",l.b="b",l.c="c",l.d="d",l.e="e",l.f="f",l.g="g",l.h="h",l.i="i",l.j="j",l.k="k",l.l="l",l.m="m",l.n="n",l.o="o",l.p="p",l.q="q",l.r="r",l.s="s",l.t="t",l.u="u",l.v="v",l.w="w",l.x="x",l.y="y",l.z="z";var K=n(7026),M=n(7982);async function A(e){return new Promise((t,n)=>(0,K.Qc)(e,{relaxColumnCount:!0,relaxQuotes:!0},(e,n)=>{if(e)console.error(e),t([[""]]);else{let e=n.reduce((e,t)=>Math.max(t.length,e),0);n.forEach(t=>{for(;t.length<e;)t.push("")}),0===n.length?n=[[""]]:0===n[0].length&&n[0].push(""),t(n)}}))}async function T(e){return new Promise((t,n)=>(0,M.Pz)(e,{eof:!1},(e,n)=>{e?(console.error(e),t("")):t(n)}))}class L{select(){this.cellEditState[1]([this.rowIndex,this.cellIndex])}constructor(e,t,n){this.cellEditState=e,this.rowIndex=t,this.cellIndex=n,this.name="Edit",this.icon=u.TzT,this.keys="F2, Enter"}}class N{get disabled(){let e=this.selectionReducer[0].file.tableSelection;return!e.contains(this.rowIndex,this.cellIndex)&&!e.isFocus(this.rowIndex,this.cellIndex)}constructor(e,t,n,s){this.csvState=e,this.selectionReducer=t,this.rowIndex=n,this.cellIndex=s}}class U extends N{select(){let[e,t]=this.csvState,[n]=this.selectionReducer;n.file.tableSelection.clearCells(e),t([...e])}constructor(...e){super(...e),this.name="Clear",this.icon=p.Vui,this.keys="Delete"}}class H extends N{async select(){let[e,t]=this.csvState,[n]=this.selectionReducer,s=n.file.tableSelection.copyCells(e);t([...e]),await navigator.clipboard.writeText(await T(s))}constructor(...e){super(...e),this.name="Copy",this.icon=p.kZ_,this.keys="Ctrl + C"}}class q extends H{async select(){await super.select(),new U(this.csvState,this.selectionReducer,this.rowIndex,this.cellIndex).select()}constructor(...e){super(...e),this.name="Cut",this.icon=u.DCV,this.keys="Ctrl + X"}}class O extends N{async select(){let[e]=this.selectionReducer,t=await navigator.clipboard.readText();if(t){let[n,s]=this.csvState,l=await A(t);e.file.tableSelection.pasteCells(n,l,this.rowIndex,this.cellIndex),s([...n])}}get disabled(){return!1}constructor(...e){super(...e),this.name="Paste",this.icon=p.O4,this.keys="Ctrl + V"}}class P{select(){let[e,t]=this.csvState,n=this.rowIndex+(this.above?0:1),s=e[0].map(()=>"");e.splice(n,0,s),t([...e]);let[,l]=this.selectionReducer;l({action:"insertRow",rowIndex:n}),l({action:"commitDraft"})}constructor(e,t,n,s){this.csvState=e,this.selectionReducer=t,this.rowIndex=n,this.above=s,this.name="Insert Row ".concat(this.above?"Above":"Below"),this.icon=u.ZhI,this.className="rotate".concat(this.above?"-90":"90")}}class W{select(){let[e,t]=this.csvState,n=this.columnIndex+(this.before?0:1);for(let t of e)t.splice(n,0,"");t([...e]);let[,s]=this.selectionReducer;s({action:"insertColumn",columnIndex:n}),s({action:"commitDraft"})}constructor(e,t,n,s){this.csvState=e,this.selectionReducer=t,this.columnIndex=n,this.before=s,this.name="Insert Column ".concat(this.before?"Before":"After"),this.icon=u.ZhI,this.className="rotate".concat(this.before?"180":"0")}}class B{select(){let[e,t]=this.csvState,n=this.rowIndex,s=e[n].slice();e.splice(n,0,s),t([...e]);let[,l]=this.selectionReducer;l({action:"insertRow",rowIndex:n+1}),l({action:"commitDraft"})}constructor(e,t,n){this.csvState=e,this.selectionReducer=t,this.rowIndex=n,this.name="Clone Row",this.icon=p.WM4}}class _{select(){let[e,t]=this.csvState,n=this.columnIndex;for(let t of e)t.splice(n,0,t[n]);t([...e]);let[,s]=this.selectionReducer;s({action:"insertColumn",columnIndex:n+1}),s({action:"commitDraft"})}constructor(e,t,n){this.csvState=e,this.selectionReducer=t,this.columnIndex=n,this.name="Clone Column",this.icon=p.WM4}}class V{select(){let[e,t]=this.csvState,n=this.rowIndex+(this.up?-1:1),s=e[this.rowIndex];e[this.rowIndex]=e[n],e[n]=s,t([...e])}get disabled(){let[e]=this.csvState;return this.up&&0===this.rowIndex||!this.up&&this.rowIndex>=e.length-1}constructor(e,t,n,s){this.csvState=e,this.selectionReducer=t,this.rowIndex=n,this.up=s,this.name="Move Row ".concat(this.up?"Up":"Down"),this.icon=this.up?u.FPD:u.r5q}}class Z{select(){let[e,t]=this.csvState,n=this.columnIndex+(this.left?-1:1);for(let t of e){let e=t[this.columnIndex];t[this.columnIndex]=t[n],t[n]=e}t([...e])}get disabled(){let[e]=this.csvState;return this.left&&0===this.columnIndex||!this.left&&this.columnIndex>=e[0].length-1}constructor(e,t,n,s){this.csvState=e,this.selectionReducer=t,this.columnIndex=n,this.left=s,this.name="Move Column ".concat(this.left?"Left":"Right"),this.icon=this.left?u.acZ:u.eFW}}class G{select(){let[e,t]=this.csvState;e.splice(this.rowIndex,1),t([...e]);let[,n]=this.selectionReducer;n({action:"insertRow",rowIndex:this.rowIndex,rows:-1}),n({action:"commitDraft"})}get disabled(){let[e]=this.csvState;return e.length<2}constructor(e,t,n){this.csvState=e,this.selectionReducer=t,this.rowIndex=n,this.name="Delete Row",this.icon=p.Vui}}class z{select(){let[e,t]=this.csvState;for(let t of e)t.splice(this.columnIndex,1);t([...e]);let[,n]=this.selectionReducer;n({action:"insertColumn",columnIndex:this.columnIndex,columns:-1}),n({action:"commitDraft"})}get disabled(){let[e]=this.csvState;return e[0].length<2}constructor(e,t,n){this.csvState=e,this.selectionReducer=t,this.columnIndex=n,this.name="Delete Column",this.icon=p.Vui}}class Q{constructor(){this.separator=!0}}class X{constructor(e){this.items=e,this.name="Row",this.icon=u.u7T}}class Y{constructor(e){this.items=e,this.name="Column",this.icon=u.rWw}}function J(e){var t;let{csvState:n,rowIndex:s,cellIndex:l,onEdit:i,onMenu:r,selectionReducer:a,cellEditState:[u,d],mouseDownState:[h,f],navKeyRepeater:m}=e,[v]=n,[x,w]=a,[g,p]=(0,D.useState)(""),[R,y]=(0,D.useState)(!1),[b,C]=(0,D.useState)(),S=(0,D.useRef)(null),I=x.file.tableSelection;(0,D.useEffect)(()=>{if(I.isFocus(s,l)&&!F()){var e;null===(e=S.current)||void 0===e||e.focus()}});let E=null===(t=v[s])||void 0===t?void 0:t[l];function F(){return u[0]===s&&u[1]===l}return g!==E&&p(E),F()&&!R&&(y(!0),function(){var e,t;let n=document.createElement("textarea"),s=()=>n.scrollHeight+2;null===(e=S.current)||void 0===e||e.append(n),null===(t=S.current)||void 0===t||t.classList.add("editing"),n.value=g,n.style.height="".concat(s(),"px"),n.focus(),n.addEventListener("blur",()=>{var e;n.value!==g&&(p(n.value),null==i||i(n.value)),n.remove(),null===(e=S.current)||void 0===e||e.classList.remove("editing"),y(!1),d([-1,-1])}),n.addEventListener("input",()=>{let e=s();n.offsetHeight<e&&(n.style.height="".concat(s(),"px"))}),C(n)}()),(0,c.jsx)("td",{ref:S,tabIndex:s*v[0].length+l,className:k({selected:I.contains(s,l),focused:I.isFocus(s,l)}),onDoubleClick:function(){F()||d([s,l])},onContextMenu:function(e){!F()&&r&&r(e)},onMouseDown:function(e){if(!F()){if(f([s,l,!!e.ctrlKey&&I.contains(s,l)]),0!==e.button)w({action:"setFocus",rowIndex:s,cellIndex:l});else if(e.shiftKey){let t=I.focusRow,n=I.focusCell;I.hasFocus()||(t=s,n=l,w({action:"setFocus",rowIndex:s,cellIndex:l})),e.ctrlKey&&!I.contains(t,n)?w({action:"excludeRange",range:[t,n,s,l]}):w({action:"selectRange",range:[t,n,s,l],clear:!e.ctrlKey,replace:!0})}else w({action:"setFocus",rowIndex:s,cellIndex:l}),e.ctrlKey&&I.contains(s,l)?w({action:"excludeRange",range:[s,l]}):e.ctrlKey?w({action:"selectRange",range:[s,l]}):w({action:"clearSelection"});document.activeElement instanceof HTMLElement&&document.activeElement.blur()}},onMouseUp:function(e){F()||(w({action:"commitDraft"}),f([-1,-1]))},onMouseEnter:function(e){!F()&&h[0]>=0&&h[1]>=0&&(h[2]?w({action:"excludeRange",range:[h[0],h[1],s,l],draft:!0}):w({action:"selectRange",range:[I.focusRow,I.focusCell,s,l],draft:!0,replace:!0}))},onKeyDown:function(e){var t,s;if(!I.hasFocus())return;let l=I.focusRow,i=I.focusCell,c=e.key,r=u[0]>=0&&u[1]>=0;c===o.Escape&&r?(e.preventDefault(),b&&(b.value=g),null===(t=S.current)||void 0===t||t.focus()):c!==o.F2||r?c!==o.Enter||e.ctrlKey||e.shiftKey?r||(c!==o.Escape||I.isEmpty()?c===o.Delete?(e.preventDefault(),new U(n,a,l,i).select()):c===o.c&&e.ctrlKey?(e.preventDefault(),new H(n,a,l,i).select()):c===o.x&&e.ctrlKey?(e.preventDefault(),new q(n,a,l,i).select()):c===o.v&&e.ctrlKey?(e.preventDefault(),new O(n,a,l,i).select()):function(e){let t=I.focusRow,n=I.focusCell,s=e.key,l=v.length-1,i=v[t].length-1,c={[o.ArrowUp]:-1,[o.ArrowDown]:1,[o.Tab]:e.shiftKey?0===n?-1:0:n===i?1:0,[o.Home]:e.ctrlKey?-t:0,[o.End]:e.ctrlKey?l-t:0}[s],r={[o.ArrowLeft]:-1,[o.ArrowRight]:1,[o.Tab]:e.shiftKey?0===n?i:-1:n===i?-i:1,[o.Home]:-n,[o.End]:i-n}[s],a=[o.ArrowUp,o.ArrowDown,o.ArrowLeft,o.ArrowRight];if((void 0!==c||void 0!==r)&&e.preventDefault(),(0!==c||0!==r)&&m.onKeyDown(s)){let o=t+(null!=c?c:0),u=n+(null!=r?r:0);if(o>=0&&o<=l&&u>=0&&u<=i){if(w({action:"setFocus",rowIndex:o,cellIndex:u}),0>a.indexOf(s))return;e.shiftKey?w({action:I.contains(t,n)?"expandRange":"selectRange",range:[t,n,o,u],clear:!e.ctrlKey}):e.ctrlKey&&I.contains(t,n)&&I.contains(o,u)?w({action:"excludeRange",range:[t,n]}):e.ctrlKey&&w({action:"selectRange",range:[t,n,o,u]})}}}(e):(e.preventDefault(),w({action:"clearSelection"}))):(e.preventDefault(),r)?null===(s=S.current)||void 0===s||s.focus():d([l,i]):(e.preventDefault(),d([l,i]))},onKeyUp:function(e){m.onKeyUp(e.key)},children:(0,c.jsx)("span",{children:g})})}function $(e){let{csv:t,cellIndex:n,selectionReducer:[s,l],onMenu:i}=e;return(0,c.jsx)("th",{onMouseDown:function(e){if(0!==e.button)return;let i=s.file.tableSelection,o=s.file.tableSelection.focusCell;i.hasFocus()||(l({action:"setFocus",rowIndex:0,cellIndex:n}),o=n),e.shiftKey?l({action:"selectRange",range:[0,o,t.length-1,n],clear:!e.ctrlKey}):(l({action:"setFocus",rowIndex:0,cellIndex:n}),l({action:"selectRange",range:[0,n,t.length-1,n],clear:!e.ctrlKey}))},onContextMenu:i,children:function(e){let t=String.fromCharCode(65+e%26);for(;e>=26;)t=String.fromCharCode(65+(e=Math.floor(e/26)-1)%26)+t;return t}(n)})}function ee(e){let{csv:t,rowIndex:n,selectionReducer:[s,l],onMenu:i}=e;return(0,c.jsx)("th",{onMouseDown:function(e){if(0!==e.button)return;let i=s.file.tableSelection,o=s.file.tableSelection.focusRow;i.hasFocus()||(l({action:"setFocus",rowIndex:n,cellIndex:0}),o=n),e.shiftKey?l({action:"selectRange",range:[o,0,n,t[n].length-1],clear:!e.ctrlKey}):(l({action:"setFocus",rowIndex:n,cellIndex:0}),l({action:"selectRange",range:[n,0,n,t[n].length-1],clear:!e.ctrlKey}))},onContextMenu:i,children:n+1})}function et(e){let{csv:t,selectionReducer:[,n]}=e;return(0,c.jsx)("th",{onClick:function(e){e.preventDefault(),n({action:"selectRange",range:[0,0,t.length-1,t[0].length-1],clear:!0})}})}function en(e){let[t]=(0,D.useState)(new es);return t}class es{onKeyDown(e){let t=new Date().getTime();return(void 0===this.keyDownTimestamp[e]||t-this.keyDownTimestamp[e]>this.interval)&&(this.keyDownTimestamp[e]=t,!0)}onKeyUp(e){delete this.keyDownTimestamp[e]}constructor(e=50){this.interval=e,this.keyDownTimestamp={}}}function el(e){let{items:t,x:n,y:s,remove:l,viewportWidth:i,viewportHeight:a}=e,d=(0,D.useRef)(null),h=en();function f(e){var t;(null===(t=d.current)||void 0===t?void 0:t.contains(e.target))||null==l||l()}function m(e,t){var n,s,i,c,r,a,u,f,m,v,x,g,p,R,y,b,C;let S=e.key;if(S===o.Escape)e.preventDefault(),null==l||l();else if(S===o.Home||S===o.End){e.preventDefault();let t=[...null!==(u=null!==(a=null===(c=d.current)||void 0===c?void 0:null===(i=c.querySelector("li:focus"))||void 0===i?void 0:null===(s=i.parentElement)||void 0===s?void 0:s.children)&&void 0!==a?a:null===(r=d.current)||void 0===r?void 0:r.querySelectorAll(".root-menu > li"))&&void 0!==u?u:[]].filter(e=>e.tabIndex>=0);t.length>0&&t[S===o.Home?0:t.length-1].focus()}else if(S===o.ArrowDown||S===o.ArrowUp){if(e.preventDefault(),h.onKeyDown(S)){let e=null===(f=d.current)||void 0===f?void 0:f.querySelector("li:focus");if(e){let t=S===o.ArrowDown?"nextElementSibling":"previousElementSibling";for(let n=e[t];n;n=n[t])if(n.tabIndex>=0){n.focus();break}}else{let e=null===(m=d.current)||void 0===m?void 0:m.querySelectorAll(".root-menu > li[tabindex]"),t=S===o.ArrowDown?0:(null!==(x=null==e?void 0:e.length)&&void 0!==x?x:1)-1;null==e||null===(v=e.item(t))||void 0===v||v.focus()}}}else if(S===o.ArrowRight||S===o.Enter&&(null==t?void 0:null===(n=t.items)||void 0===n?void 0:n.length)){if(e.preventDefault(),h.onKeyDown(S)){let e=null===(g=d.current)||void 0===g?void 0:g.querySelectorAll("li:focus > ul > li[tabindex]");if(null==e?void 0:e.length){let t=e.item(0);null===(R=t.parentElement)||void 0===R||null===(p=R.closest("li"))||void 0===p||p.classList.add("expanded"),t.focus()}}}else if(S===o.ArrowLeft){if(e.preventDefault(),h.onKeyDown(S)){let e=null===(C=d.current)||void 0===C?void 0:null===(b=C.querySelector("li:focus"))||void 0===b?void 0:null===(y=b.parentElement)||void 0===y?void 0:y.closest("li");null==e||e.classList.remove("expanded"),null==e||e.focus()}}else S===o.Enter&&t&&(e.preventDefault(),w(t))}function v(e){h.onKeyUp(e.key)}function x(){var e,t;null===(e=d.current)||void 0===e||e.focus(),null===(t=d.current)||void 0===t||t.querySelectorAll("li.expanded").forEach(e=>e.classList.remove("expanded"))}function w(e){var t;null==l||l(),null===(t=e.select)||void 0===t||t.call(e)}return(0,D.useEffect)(()=>(window.addEventListener("mousedown",f,!1),()=>{window.removeEventListener("mousedown",f,!1)})),(0,D.useEffect)(()=>{let e=d.current;if(e){e.style.left="0",e.style.top="0",e.querySelectorAll("ul").forEach(e=>{e.style.display="block",e.style.left="100%",e.style.right="auto",e.style.top="0",e.style.bottom="auto"});let t=e.scrollWidth,l=e.scrollHeight,o=e.offsetWidth,c=e.offsetHeight;e.querySelectorAll("ul").forEach(e=>{e.style.display="",e.style.left="",e.style.right="",e.style.top="",e.style.bottom=""}),e.style.left="".concat(n>i-o?n-o:n,"px"),e.style.top="".concat(s>a-c?s-c:s,"px"),e.classList.toggle("menu-right",n>i-t),e.classList.toggle("menu-bottom",s>a-l),e.focus()}}),(0,c.jsx)("nav",{className:"menu",ref:d,tabIndex:0,style:{display:t.length>0?"block":"none"},onContextMenu:e=>e.preventDefault(),onKeyDown:m,onKeyUp:v,children:function e(t,n){return(0,c.jsx)("ul",{className:k({"root-menu":n}),children:t.map((t,n)=>t.separator?(0,c.jsx)("li",{className:"separator"},n):(0,c.jsxs)("li",{tabIndex:t.disabled?-1:n,className:k(t.className,{disabled:t.disabled}),onClick:e=>w(t),onKeyDown:e=>m(e,t),onKeyUp:v,onMouseOver:x,children:[(0,c.jsx)("span",{className:"icon",children:t.icon&&(0,c.jsx)(r.G,{icon:t.icon})}),(0,c.jsx)("span",{className:"name",children:t.name}),(0,c.jsx)("span",{className:"keys",children:t.keys}),t.items&&(0,c.jsx)("span",{className:"expand",children:(0,c.jsx)(r.G,{icon:u.I4f})}),t.items&&e(t.items)]},n))})}(t,!0)})}class ei{getRowItems(e){return[new B(this.csvState,this.selectionReducer,e),new P(this.csvState,this.selectionReducer,e,!0),new P(this.csvState,this.selectionReducer,e,!1),new Q,new V(this.csvState,this.selectionReducer,e,!0),new V(this.csvState,this.selectionReducer,e,!1),new Q,new G(this.csvState,this.selectionReducer,e)]}getColumnItems(e){return[new _(this.csvState,this.selectionReducer,e),new W(this.csvState,this.selectionReducer,e,!0),new W(this.csvState,this.selectionReducer,e,!1),new Q,new Z(this.csvState,this.selectionReducer,e,!0),new Z(this.csvState,this.selectionReducer,e,!1),new Q,new z(this.csvState,this.selectionReducer,e)]}buildMenu(e,t){return e>=0&&t>=0?[new L(this.cellEditState,e,t),new Q,new q(this.csvState,this.selectionReducer,e,t),new H(this.csvState,this.selectionReducer,e,t),new O(this.csvState,this.selectionReducer,e,t),new U(this.csvState,this.selectionReducer,e,t),new Q,new X(this.getRowItems(e)),new Y(this.getColumnItems(t))]:e>=0?this.getRowItems(e):t>=0?this.getColumnItems(t):[]}constructor(e,t,n){this.csvState=e,this.cellEditState=t,this.selectionReducer=n}}function eo(e){let{file:t}=e,[n,s]=(0,D.useState)(-1),l=(0,D.useState)([]),[i,o]=l,r=(0,D.useState)([-1,-1]),[a,u]=r,d=(0,D.useState)([-1,-1]),h=en(),f=(0,D.useReducer)(v,{file:t}),[m,x]=f,[w,g]=(0,D.useState)(),p=(0,D.useRef)(null),R=new ei(l,d,f);function y(){u([-1,-1])}async function b(e,t,n){i[e][t]=n,o([...i])}function C(e,t,n){var s,l;if(e.preventDefault(),!p.current)return;let i=p.current.querySelector("table.content").getBoundingClientRect(),o=p.current.querySelector("table.columns").offsetHeight,c=p.current.offsetHeight;g({items:R.buildMenu(t,n),x:e.clientX-(null!==(s=i.x)&&void 0!==s?s:0),y:e.clientY-(null!==(l=i.y)&&void 0!==l?l:0)+o,viewportWidth:i.width,viewportHeight:c,remove:()=>g(void 0)})}return(0,D.useEffect)(()=>(a&&window.addEventListener("mouseup",y,!1),()=>{window.removeEventListener("mouseup",y,!1)})),(0,D.useEffect)(()=>{m.file.tableSelection.hasFocus()||x({action:"setFocus",rowIndex:0,cellIndex:0})}),(0,D.useEffect)(()=>{T(i).then(e=>t.textContent=e)},[i,t]),f[0].file!==t&&(u([-1,-1]),f[1]({file:t,action:"update"})),n!==t.id&&(s(t.id),A(t.textContent).then(e=>o(e))),(0,c.jsxs)("div",{className:"table-editor",ref:p,children:[i.length>0&&(0,c.jsx)("table",{className:"columns",children:(0,c.jsx)("thead",{children:(0,c.jsxs)("tr",{children:[(0,c.jsx)(et,{csv:i,selectionReducer:f}),i[0].map((e,t)=>(0,c.jsx)($,{cellIndex:t,csv:i,selectionReducer:f,onMenu:e=>C(e,-1,t)},t))]})})}),(0,c.jsx)("table",{className:"content",children:(0,c.jsx)("tbody",{children:i.map((e,t)=>(0,c.jsxs)("tr",{style:{zIndex:i.length-t},children:[(0,c.jsx)(ee,{rowIndex:t,csv:i,selectionReducer:f,onMenu:e=>C(e,t,-1)}),e.map((e,n)=>(0,c.jsx)(J,{csvState:l,rowIndex:t,cellIndex:n,selectionReducer:f,mouseDownState:r,cellEditState:d,navKeyRepeater:h,onEdit:e=>b(t,n,e),onMenu:e=>C(e,t,n)},n))]},t))})}),w&&(0,c.jsx)(el,{...w})]})}function ec(e){let{file:t}=e;return(0,c.jsxs)("article",{children:[t.editMode===i.Text&&(0,c.jsx)(j,{file:t}),t.editMode===i.Table&&(0,c.jsx)(eo,{file:t})]})}function er(){let e=(0,D.useReducer)(F,{files:[]}),[t,n]=e;return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("header",{children:(0,c.jsx)(E,{filesReducer:e})}),(0,c.jsx)("main",{children:t.selectedFile&&(0,c.jsx)(ec,{file:t.selectedFile})})]})}}},function(e){e.O(0,[676,878,971,938,744],function(){return e(e.s=9215)}),_N_E=e.O()}]);