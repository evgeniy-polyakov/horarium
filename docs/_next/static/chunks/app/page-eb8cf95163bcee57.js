(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{9215:function(e,t,n){Promise.resolve().then(n.bind(n,4398))},4398:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return _}});var l,s,i=n(7437),o=n(504);function c(e){let{icon:t,hint:n,onClick:l}=e;return(0,i.jsx)("button",{className:"icon",onClick:l,title:n,children:(0,i.jsx)(o.G,{icon:t})})}var a=n(2759);class r{async load(e){let t=await new Promise(t=>{let n=new FileReader;n.addEventListener("load",e=>{var n;t(null===(n=e.target)||void 0===n?void 0:n.result)}),n.readAsText(e)});if(!t)throw Error("Cannot read file ".concat(e.name));return t}async save(e,t){let n=document.createElement("a"),l=URL.createObjectURL(new Blob([e],{type:this.mimeType}));n.href=l,n.download=t,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(l)}constructor(e,t){this.extension=e,this.mimeType=t}}let d=[new r("csv","text/csv")];(l=s||(s={})).Text="text",l.Table="table";class h{contains(e,t){for(let n=0;n<this.excluded.length;n+=2)if(this.excluded[n]===e&&this.excluded[n+1]===t)return!1;return this.inRange(e,t)}exclude(e,t){if("number"==typeof e&&"number"==typeof t)this.contains(e,t)&&this.excluded.push(e,t);else if("object"==typeof e){let t=Math.min(e.startRow,e.endRow),n=Math.max(e.startRow,e.endRow),l=Math.min(e.startCell,e.endCell),s=Math.max(e.startCell,e.endCell);for(let e=t;e<=n;e++)for(let t=l;t<=s;t++)this.exclude(e,t)}}expand(e,t){this.endRow=e,this.endCell=t,this.excluded=[]}isEmpty(){return this.excluded.length>=(1+Math.abs(this.startRow-this.endRow))*(1+Math.abs(this.startCell-this.endCell))*2}inRange(e,t){return(this.startRow<=this.endRow?e>=this.startRow&&e<=this.endRow:e<=this.startRow&&e>=this.endRow)&&(this.startCell<=this.endCell?t>=this.startCell&&t<=this.endCell:t<=this.startCell&&t>=this.endCell)}constructor(e,t,n,l){this.startRow=e,this.startCell=t,this.endRow=n,this.endCell=l,this.excluded=[]}}class u{contains(e,t){return this.ranges.some(n=>n.contains(e,t))}toggleSelection(e,t,n){if(16&n)this.ranges=[new h(0,0,e,t)];else if(8&n&&4&n){if(0===this.ranges.length)this.ranges.push(new h(e,t,e,t));else{let n=this.ranges[this.ranges.length-1];n.expand(e,t),this.swallowRanges(n)}}else if(8&n)0===this.ranges.length?this.ranges.push(new h(e,t,e,t)):(this.ranges[this.ranges.length-1].expand(e,t),this.ranges=this.ranges.slice(-1));else if(4&n){if(1&n){let n=new h(e,t,e,t);this.ranges.push(n),this.swallowRanges(n)}else this.ranges.forEach(n=>n.exclude(e,t)),this.clearRanges()}else this.ranges=[new h(e,t,e,t)]}swallowRanges(e){this.ranges.forEach(t=>{t!==e&&t.exclude(e)}),this.clearRanges()}clearRanges(){this.ranges=this.ranges.filter(e=>!e.isEmpty())}constructor(){this.ranges=[]}}function f(e,t){return"update"===t.mode?{...e,file:t.file}:(e.file.cellSelection.toggleSelection(t.rowIndex,t.cellIndex,t.mode),{...e})}let x=0;class m{async load(){this.file&&(this.textContent=await this.loader.load(this.file))}async save(){await this.loader.save(this.textContent,this.filename)}constructor(e){var t;if(this.file=e,this.id=++x,this.textContent="",this.selected=!1,this.editMode=s.Table,this.cellSelection=new u,this.filename=null!==(t=null==e?void 0:e.name)&&void 0!==t?t:"untitled.csv",this.extension=this.filename.replace(/^.*\.(\w+)$/,"$1").toLowerCase(),this.loader=d.filter(e=>e.extension===this.extension)[0],!this.loader)throw Error("Unknown file extension ".concat(this.filename))}}function v(e){let{onOpen:t}=e;return(0,i.jsx)(c,{icon:a.cC_,onClick:function(){let e=document.createElement("input");e.type="file",e.multiple=!0,e.accept=d.map(e=>".".concat(e.extension,",").concat(e.mimeType)).join(","),e.onchange=async()=>{if(e.files)for(let n=0;n<e.files.length;n++){let l=new m(e.files.item(n));await l.load(),null==t||t(l)}},e.click()},hint:"Open File"})}var g=n(7188);function w(e){var t;let{item:n,onSelect:l,onRemove:s}=e,r="tab ".concat(n.selected?"selected":""," ").concat(n.editable?"editable":"");return(0,i.jsxs)("li",{className:r,children:[(0,i.jsxs)("button",{className:"label",title:null!==(t=n.hint)&&void 0!==t?t:n.name,onClick:()=>{n.selected||null==l||l()},children:[n.icon&&(0,i.jsx)("span",{className:"icon",children:(0,i.jsx)(o.G,{icon:n.icon})}),n.name&&(0,i.jsx)("span",{className:"name",children:n.name})]}),n.removable&&(0,i.jsx)(c,{icon:a.g82,hint:"Close",onClick:s})]})}function p(e){let{items:t,onRename:n,onSelect:l,onRemove:s}=e;return(0,i.jsx)("ul",{className:"tabs",children:t.map(e=>(0,i.jsx)(w,{item:e,onSelect:()=>null==l?void 0:l(e),onRemove:()=>null==s?void 0:s(e)},e.key))})}class j{get key(){return"".concat(this.file.id)}get selected(){return this.file.selected}get link(){return"/".concat(this.name)}constructor(e){this.file=e,this.name=this.file.filename,this.removable=!0,this.editable=!0}}class C{get selected(){return this.file.editMode===this.editMode}constructor(e,t,n,l){this.file=e,this.editMode=t,this.icon=n,this.hint=l,this.key=this.editMode,this.editable=!1,this.removable=!1}}function b(e){let{file:t}=e;async function n(){await t.save()}return(0,i.jsx)(c,{icon:a.kwI,onClick:n,hint:"Save File"})}function y(e){let{onOpen:t}=e;async function n(){let e=new m;await e.load(),null==t||t(e)}return(0,i.jsx)(c,{icon:a.gMD,onClick:n,hint:"New File"})}function R(e){let{filesReducer:t}=e,[n,l]=t,o=n.files,c=n.selectedFile;function r(e){l({file:e,type:"add"})}return(0,i.jsxs)("nav",{children:[(0,i.jsx)(v,{onOpen:r}),(0,i.jsx)(y,{onOpen:r}),c&&(0,i.jsx)(b,{file:c}),(0,i.jsx)(p,{items:o.map(e=>new j(e)),onSelect:e=>l({file:e.file,type:"select"}),onRemove:e=>l({file:e.file,type:"remove"})}),c&&(0,i.jsx)(p,{items:[new C(c,s.Text,g.nfZ,"Text"),new C(c,s.Table,a.u7T,"Table")],onSelect:e=>{c.editMode=e.editMode,l({file:n.selectedFile,type:"update"})}})]})}var k=n(2265);function E(e,t){let n=e.files;switch(t.type){case"add":n.forEach(e=>e.selected=!1);let l=n.filter(e=>e.id===t.file.id)[0];l?l.selected=!0:(t.file.selected=!0,n.push(t.file));break;case"select":n.forEach(e=>e.selected=!1),t.file.selected=!0;break;case"remove":let s=n.indexOf(t.file);s>=0&&(n.splice(s,1),t.file.selected&&(s<n.length?n[s].selected=!0:s-1>=0&&(n[s-1].selected=!0)))}return{files:n,selectedFile:n.filter(e=>e.selected)[0]}}function M(e){let{file:t}=e,[n,l]=(0,k.useState)(t.textContent);return n!==t.textContent&&l(t.textContent),(0,i.jsx)("textarea",{className:"text-editor",value:n,onChange:e=>{t.textContent=e.target.value,l(e.target.value)},onScroll:e=>{}})}var I=n(9029);function S(e){var t;let{csv:n,rowIndex:l,cellIndex:s,selectionReducer:o,onEdit:c,mouseDown:a}=e,[r,d]=(0,k.useState)(""),[h,u]=(0,k.useState)(!1),f=(0,k.useRef)(null),x=o[0].file.cellSelection,m=null===(t=n[l])||void 0===t?void 0:t[s];function v(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;e.preventDefault(),o[1]({rowIndex:l,cellIndex:s,mode:(e.ctrlKey?4:0)|(e.shiftKey?8:0)|(x.contains(l,s)?2:1)|t})}function g(e){a.get()&&!h&&(u(!0),v(e,8))}return r!==m&&d(m),!a.get()&&h&&u(!1),(0,i.jsx)("td",{ref:f,className:x.contains(l,s)?"selected":"",onDoubleClick:function(){var e;let t=document.createElement("textarea");null===(e=f.current)||void 0===e||e.append(t),t.value=r,t.style.height="".concat(t.scrollHeight+2,"px"),t.focus(),t.addEventListener("blur",()=>{t.value!==r&&(d(t.value),null==c||c(t.value)),t.remove()})},onMouseDown:function(e){a.set(!0),u(!0),v(e),document.activeElement instanceof HTMLElement&&document.activeElement.blur()},onMouseEnter:g,onMouseLeave:function(e){u(!1)},onMouseUp:function(e){a.set(!1),g(e)},children:(0,i.jsx)("span",{children:r})})}var N=n(7026);async function T(e){return new Promise((t,n)=>(0,N.Qc)(e,{relaxColumnCount:!0,relaxQuotes:!0},(e,n)=>{if(e)t([[""]]),console.error(e);else{let e=n.reduce((e,t)=>Math.max(t.length,e),0);n.forEach(t=>{for(;t.length<e;)t.push("")}),0===n.length?n=[[""]]:0===n[0].length&&n[0].push(""),t(n)}}))}function L(e){let{csv:t,cellIndex:n,selectionReducer:l}=e;return(0,i.jsx)("th",{onClick:function(e){e.preventDefault(),l[1]({rowIndex:0,cellIndex:n,mode:1|(e.shiftKey?8:0)|(e.ctrlKey?4:0)}),l[1]({rowIndex:t.length,cellIndex:n,mode:9|(e.ctrlKey?4:0)})},children:n>=0?n+1:""})}function F(e){let{csv:t,rowIndex:n,selectionReducer:l}=e;return(0,i.jsx)("th",{onClick:function(e){var s,i;e.preventDefault(),l[1]({rowIndex:n,cellIndex:0,mode:1|(e.shiftKey?8:0)|(e.ctrlKey?4:0)}),l[1]({rowIndex:n,cellIndex:null!==(i=null===(s=t[0])||void 0===s?void 0:s.length)&&void 0!==i?i:0,mode:9|(e.ctrlKey?4:0)})},children:n+1})}function D(e){let{csv:t,selectionReducer:n}=e;return(0,i.jsx)("th",{onClick:function(e){var l,s;e.preventDefault(),n[1]({rowIndex:t.length,cellIndex:null!==(s=null===(l=t[0])||void 0===l?void 0:l.length)&&void 0!==s?s:0,mode:16})}})}function K(e){let{file:t}=e,[n,l]=(0,k.useState)(""),[s,o]=(0,k.useState)([]),c=function(e){let t=(0,k.useState)(e);return{get:()=>t[0],set(e){t[1](e)}}}(!1),a=(0,k.useReducer)(f,{file:t}),r=()=>{c.set(!1)};return(0,k.useEffect)(()=>{c.get()?window.addEventListener("mouseup",r,!1):window.removeEventListener("mouseup",r,!1)},[c]),a[0].file!==t&&(c.set(!1),a[1]({file:t,mode:"update"})),n!==t.textContent&&(l(t.textContent),T(t.textContent).then(e=>o(e))),(0,i.jsxs)("div",{className:"table-editor",children:[s.length>0&&(0,i.jsx)("table",{className:"columns",children:(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{children:[(0,i.jsx)(D,{csv:s,selectionReducer:a}),s[0].map((e,t)=>(0,i.jsx)(L,{cellIndex:t,csv:s,selectionReducer:a},t))]})})}),(0,i.jsx)("table",{className:"content",children:(0,i.jsx)("tbody",{children:s.map((e,n)=>(0,i.jsxs)("tr",{style:{zIndex:s.length-n},children:[(0,i.jsx)(F,{rowIndex:n,csv:s,selectionReducer:a}),e.map((l,o)=>(0,i.jsx)(S,{csv:s,rowIndex:n,cellIndex:o,selectionReducer:a,mouseDown:c,onEdit:n=>{e[o]=n,(0,I.Pz)(s,(e,n)=>{e?console.error(e):t.textContent=n})}},o))]},n))})})]})}function O(e){let{file:t}=e;return(0,i.jsxs)("article",{children:[t.editMode===s.Text&&(0,i.jsx)(M,{file:t}),t.editMode===s.Table&&(0,i.jsx)(K,{file:t})]})}function _(){let e=(0,k.useReducer)(E,{files:[]}),[t,n]=e;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("header",{children:(0,i.jsx)(R,{filesReducer:e})}),(0,i.jsx)("main",{children:t.selectedFile&&(0,i.jsx)(O,{file:t.selectedFile})})]})}}},function(e){e.O(0,[773,676,563,971,938,744],function(){return e(e.s=9215)}),_N_E=e.O()}]);